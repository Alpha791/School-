<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Homework Portal</title>
  <style>
    :root {
      --max-width: 900px;
      --card-bg: #ffffff;
      --muted: #6b7280;
      --accent: #007bff;
    }
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f3f4f6;
      color: #111827;
      display: flex;
      justify-content: center;
    }
    .container {
      width: 100%;
      max-width: var(--max-width);
      background: var(--card-bg);
      padding: 18px;
      border-radius: 10px;
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.06);
    }
    h1 { margin-top: 0; font-size: 1.6rem; }
    input, select, textarea, button {
      width: 100%;
      font-size: 0.95rem;
      padding: 10px 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      margin-bottom: 10px;
    }
    button { cursor: pointer; }
    button[type="submit"] { background: var(--accent); color: white; border: none; }
    .secondary-btn { background: transparent; border: 1px solid #d1d5db; color: #111827; }
    .hidden { display: none; }
    .homework-box { background: #eef2ff; padding: 10px; margin: 8px 0; border-radius: 8px; word-wrap: break-word; }
    .marked-correct { background-color: #d1fae5; }
    .marked-incorrect { background-color: #fee2e2; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Homework Portal</h1>

    <!-- Login/Register -->
    <div id="authSection">
      <div>
        <button onclick="showTab('login', this)">Login</button>
        <button onclick="showTab('register', this)">Register</button>
      </div>

      <div id="loginTab">
        <input type="email" id="loginEmail" placeholder="Email" required>
        <input type="password" id="loginPassword" placeholder="Password" required>
        <button onclick="login()">Login</button>
        <div id="loginError" style="color:red;"></div>
      </div>

      <div id="registerTab" class="hidden">
        <input type="email" id="registerEmail" placeholder="Email" required>
        <input type="password" id="registerPassword" placeholder="Password" required>
        <select id="userType">
          <option value="">Select user type</option>
          <option value="teacher">Teacher</option>
          <option value="learner">Learner</option>
        </select>
        <button onclick="register()">Register</button>
        <div id="registerError" style="color:red;"></div>
        <div id="registerSuccess" style="color:green;"></div>
      </div>
    </div>

    <!-- Teacher Dashboard -->
    <div id="teacherSection" class="hidden">
      <h2>Teacher Dashboard</h2>
      <input type="text" id="hwTitle" placeholder="Homework Title">
      <textarea id="hwContent" placeholder="Homework Content"></textarea>
      <button onclick="postHomework()">Post Homework</button>
      <h3>Submitted Answers</h3>
      <div id="submittedAnswers"></div>
      <button onclick="logout()" class="secondary-btn">Logout</button>
    </div>

    <!-- Learner Dashboard -->
    <div id="learnerSection" class="hidden">
      <h2>Learner Dashboard</h2>
      <div id="homeworkList"></div>
      <h3>Submit Answer</h3>
      <select id="selectHomework"></select>
      <textarea id="learnerAnswer" placeholder="Type your answer"></textarea>
      <button onclick="submitAnswer()">Submit</button>
      <button onclick="logout()" class="secondary-btn">Logout</button>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import {
      getAuth,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      signOut,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
    import {
      getFirestore,
      collection,
      addDoc,
      getDocs,
      doc,
      setDoc,
      updateDoc,
      serverTimestamp,
      query,
      orderBy
    } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD_YydnZKjW8IdApXZKMqDHk6ZiF7Ioh-g",
      authDomain: "school-homework-f3191.firebaseapp.com",
      projectId: "school-homework-f3191",
      storageBucket: "school-homework-f3191.appspot.com",
      messagingSenderId: "104455696211",
      appId: "1:104455696211:web:f12c1823675c45064b3ba6"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const authSection = document.getElementById("authSection");
    const teacherSection = document.getElementById("teacherSection");
    const learnerSection = document.getElementById("learnerSection");

    function showTab(tab) {
      document.getElementById('loginTab').classList.toggle('hidden', tab !== 'login');
      document.getElementById('registerTab').classList.toggle('hidden', tab !== 'register');
    }

    async function register() {
      const email = document.getElementById("registerEmail").value;
      const password = document.getElementById("registerPassword").value;
      const userType = document.getElementById("userType").value;
      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        await setDoc(doc(db, "users", userCredential.user.uid), { email, userType, createdAt: serverTimestamp() });
        document.getElementById("registerSuccess").textContent = "Account created!";
      } catch (e) {
        document.getElementById("registerError").textContent = e.message;
      }
    }

    async function login() {
      const email = document.getElementById("loginEmail").value;
      const password = document.getElementById("loginPassword").value;
      try {
        await signInWithEmailAndPassword(auth, email, password);
      } catch (e) {
        document.getElementById("loginError").textContent = e.message;
      }
    }

    function logout() {
      signOut(auth);
    }

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        authSection.classList.add("hidden");
        const userDoc = await getDocs(query(collection(db,"users")));
        const userData = userDoc.docs.find(d => d.id === user.uid)?.data();
        if (userData?.userType === "teacher") {
          teacherSection.classList.remove("hidden");
          loadSubmittedAnswers();
        } else {
          learnerSection.classList.remove("hidden");
          loadHomework();
        }
      } else {
        authSection.classList.remove("hidden");
        teacherSection.classList.add("hidden");
        learnerSection.classList.add("hidden");
      }
    });

    async function postHomework() {
      const title = document.getElementById("hwTitle").value;
      const content = document.getElementById("hwContent").value;
      if (!title || !content) return alert("Enter title and content");
      await addDoc(collection(db, "homeworks"), { title, content, createdAt: serverTimestamp() });
      document.getElementById("hwTitle").value = "";
      document.getElementById("hwContent").value = "";
      loadHomework();
    }

    async function loadHomework() {
      const hwSelect = document.getElementById("selectHomework");
      const hwList = document.getElementById("homeworkList");
      hwList.innerHTML = ""; hwSelect.innerHTML = "";
      const snapshot = await getDocs(query(collection(db, "homeworks"), orderBy("createdAt","desc")));
      snapshot.forEach(docu => {
        const data = docu.data();
        hwList.innerHTML += `<div class="homework-box"><strong>${data.title}</strong><p>${data.content}</p></div>`;
        hwSelect.innerHTML += `<option value="${docu.id}">${data.title}</option>`;
      });
    }

    async function submitAnswer() {
      const hwId = document.getElementById("selectHomework").value;
      const answer = document.getElementById("learnerAnswer").value;
      if (!hwId || !answer) return alert("Select homework and type answer");
      await addDoc(collection(db,"answers"), { hwId, answer, learner: auth.currentUser.email, createdAt: serverTimestamp(), marked: false });
      document.getElementById("learnerAnswer").value = "";
      alert("Answer submitted!");
    }

    async function loadSubmittedAnswers() {
      const container = document.getElementById("submittedAnswers");
      container.innerHTML = "";
      const snapshot = await getDocs(query(collection(db,"answers"), orderBy("createdAt","desc")));
      snapshot.forEach(docu => {
        const d = docu.data();
        const div = document.createElement("div");
        div.className = "homework-box";
        div.innerHTML = `<strong>${d.learner}:</strong> ${d.answer} 
        <button onclick="markAnswer('${docu.id}', true)">Correct</button>
        <button onclick="markAnswer('${docu.id}', false)">Incorrect</button>`;
        if(d.marked !== undefined) div.classList.add(d.marked ? 'marked-correct':'marked-incorrect');
        container.appendChild(div);
      });
    }

    async function markAnswer(id, correct) {
      await updateDoc(doc(db,"answers",id), { marked: correct });
      loadSubmittedAnswers();
    }

    // Disable right click
    document.addEventListener('contextmenu', e => e.preventDefault());
  </script>
</body>
</html>
