<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Homework Portal</title>
<style>
  :root {
    --accent: #4f46e5;
    --card-bg: rgba(255,255,255,0.95);
    --text-color: #111827;
    --input-border: #d1d5db;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Arial, sans-serif; }

  body {
    position: relative;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    background: url('https://raw.githubusercontent.com/Alpha791/School-/main/wander-fleur-1lmGTHdQdjM-unsplash.jpg') no-repeat center center fixed;
    background-size: cover;
  }

  body::before {
    content: "";
    position: absolute;
    top:0; left:0;
    width:100%; height:100%;
    background: rgba(0,0,0,0.4);
    z-index:0;
  }

  .container {
    position: relative;
    z-index:1;
    width: 90%;
    max-width: 450px;
    background: var(--card-bg);
    border-radius: 15px;
    padding: 30px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    overflow-y: auto;
    max-height: 95vh;
  }

  h1 { text-align:center; color: var(--accent); margin-bottom:25px; }

  input, select, textarea, button {
    width:100%;
    padding:12px 15px;
    margin-bottom:15px;
    border-radius:8px;
    border:1px solid var(--input-border);
    font-size:1rem;
  }

  textarea { resize: vertical; min-height:80px; }

  button { cursor:pointer; font-weight:bold; transition:0.2s; }
  .primary-btn { background: var(--accent); color:white; border:none; }
  .primary-btn:hover { background:#4338ca; }
  .secondary-btn { background:transparent; border:1px solid var(--input-border); color:var(--text-color); }
  .secondary-btn:hover { background:var(--input-border); }

  .hidden { display:none; }

  .tabs { display:flex; justify-content:space-between; margin-bottom:20px; }
  .tabs button {
    width:48%; background:#e5e7eb; border:none; border-radius:8px; padding:10px 0; font-weight:bold; color:var(--text-color); transition:0.2s;
  }
  .tabs button:hover { background:#d1d5db; }

  .homework-box { background:#eef2ff; padding:12px; border-radius:10px; margin-bottom:10px; word-wrap:break-word; }
  .marked-correct { background-color:#d1fae5; }
  .marked-incorrect { background-color:#fee2e2; }

  @media (max-width:500px){ .container{padding:20px;} h1{font-size:1.5rem;} }
</style>
</head>
<body>
<div class="container">
  <h1>Homework Portal</h1>

  <!-- Auth Section -->
  <div id="authSection">
    <div class="tabs">
      <button onclick="showTab('login')">Login</button>
      <button onclick="showTab('register')">Register</button>
    </div>

    <!-- Login -->
    <div id="loginTab">
      <input type="email" id="loginEmail" placeholder="Email" required>
      <input type="password" id="loginPassword" placeholder="Password" required>
      <button class="primary-btn" onclick="login()">Login</button>
      <div id="loginError" style="color:red;"></div>
    </div>

    <!-- Register -->
    <div id="registerTab" class="hidden">
      <input type="email" id="registerEmail" placeholder="Email" required>
      <input type="password" id="registerPassword" placeholder="Password" required>
      <select id="userType">
        <option value="">Select user type</option>
        <option value="teacher">Teacher</option>
        <option value="learner">Learner</option>
      </select>
      <input type="text" id="teacherCode" class="hidden" placeholder="Enter teacher code">
      <button class="primary-btn" onclick="register()">Register</button>
      <div id="registerError" style="color:red;"></div>
      <div id="registerSuccess" style="color:green;"></div>
    </div>
  </div>

  <!-- Teacher Dashboard -->
  <div id="teacherSection" class="hidden">
    <h2>Teacher Dashboard</h2>
    <input type="text" id="hwTitle" placeholder="Homework Title">
    <textarea id="hwContent" placeholder="Homework Content"></textarea>
    <button class="primary-btn" onclick="postHomework()">Post Homework</button>
    <h3>Submitted Answers</h3>
    <div id="submittedAnswers"></div>
    <button onclick="logout()" class="secondary-btn">Logout</button>
  </div>

  <!-- Learner Dashboard -->
  <div id="learnerSection" class="hidden">
    <h2>Learner Dashboard</h2>
    <div id="homeworkList"></div>
    <h3>Submit Answer</h3>
    <select id="selectHomework"></select>
    <textarea id="learnerAnswer" placeholder="Type your answer"></textarea>
    <button class="primary-btn" onclick="submitAnswer()">Submit</button>
    <button onclick="logout()" class="secondary-btn">Logout</button>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
  import { getFirestore, collection, addDoc, getDocs, doc, setDoc, updateDoc, serverTimestamp, query, orderBy, getDoc } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "secret.FIREBASEAPIKEY",
    authDomain: "school-homework-f3191.firebaseapp.com",
    projectId: "school-homework-f3191",
    storageBucket: "school-homework-f3191.appspot.com",
    messagingSenderId: "104455696211",
    appId: "1:104455696211:web:f12c1823675c45064b3ba6"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const authSection = document.getElementById("authSection");
  const teacherSection = document.getElementById("teacherSection");
  const learnerSection = document.getElementById("learnerSection");

  window.showTab = (tab) => {
    document.getElementById("loginTab").classList.toggle("hidden", tab !== "login");
    document.getElementById("registerTab").classList.toggle("hidden", tab !== "register");
  }

  document.getElementById("userType").addEventListener("change", (e) => {
    document.getElementById("teacherCode").classList.toggle("hidden", e.target.value !== "teacher");
  });

  async function register() {
    const email = document.getElementById("registerEmail").value.trim();
    const password = document.getElementById("registerPassword").value.trim();
    const userType = document.getElementById("userType").value;
    const teacherCode = document.getElementById("teacherCode").value.trim();
    try {
      if(!email||!password) throw new Error("Please fill in all fields.");
      if(!userType) throw new Error("Please select user type.");
      if(userType==="teacher" && teacherCode!=="0852") throw new Error("Invalid teacher code.");
      const userCredential = await createUserWithEmailAndPassword(auth,email,password);
      await setDoc(doc(db,"users",userCredential.user.uid),{email,userType,createdAt:serverTimestamp()});
      document.getElementById("registerSuccess").textContent="Account created successfully!";
      document.getElementById("registerError").textContent="";
    } catch(e){ document.getElementById("registerError").textContent=e.message; }
  }

  async function login() {
    const email = document.getElementById("loginEmail").value.trim();
    const password = document.getElementById("loginPassword").value.trim();
    try { await signInWithEmailAndPassword(auth,email,password); document.getElementById("loginError").textContent=""; } 
    catch(e){ document.getElementById("loginError").textContent=e.message; }
  }

  window.logout=()=>signOut(auth);

  onAuthStateChanged(auth,async(user)=>{
    if(user){
      authSection.classList.add("hidden");
      const snap=await getDoc(doc(db,"users",user.uid));
      const userData=snap.data();
      if(userData?.userType==="teacher"){ teacherSection.classList.remove("hidden"); learnerSection.classList.add("hidden"); loadSubmittedAnswers(); }
      else{ learnerSection.classList.remove("hidden"); teacherSection.classList.add("hidden"); loadHomework(); }
    }else{
      authSection.classList.remove("hidden");
      teacherSection.classList.add("hidden");
      learnerSection.classList.add("hidden");
    }
  });

  async function postHomework(){
    const title=document.getElementById("hwTitle").value.trim();
    const content=document.getElementById("hwContent").value.trim();
    if(!title||!content) return alert("Enter title and content");
    await addDoc(collection(db,"homeworks"),{title,content,createdAt:serverTimestamp()});
    document.getElementById("hwTitle").value=""; document.getElementById("hwContent").value="";
    alert("Homework posted!"); loadHomework();
  }

  async function loadHomework(){
    const hwSelect=document.getElementById("selectHomework");
    const hwList=document.getElementById("homeworkList");
    hwList.innerHTML=""; hwSelect.innerHTML="";
    const snapshot=await getDocs(query(collection(db,"homeworks"),orderBy("createdAt","desc")));
    snapshot.forEach(docu=>{
      const data=docu.data();
      hwList.innerHTML+=`<div class="homework-box"><strong>${data.title}</strong><p>${data.content}</p></div>`;
      hwSelect.innerHTML+=`<option value="${docu.id}">${data.title}</option>`;
    });
  }

  async function submitAnswer(){
    const hwId=document.getElementById("selectHomework").value;
    const answer=document.getElementById("learnerAnswer").value.trim();
    if(!hwId||!answer) return alert("Select homework and type answer");
    await addDoc(collection(db,"answers"),{hwId,answer,learner:auth.currentUser.email,createdAt:serverTimestamp(),marked:null});
    document.getElementById("learnerAnswer").value=""; alert("Answer submitted!");
  }

  async function loadSubmittedAnswers(){
    const container=document.getElementById("submittedAnswers"); container.innerHTML="";
    const snapshot=await getDocs(query(collection(db,"answers"),orderBy("createdAt","desc")));
    snapshot.forEach(docu=>{
      const d=docu.data(); const div=document.createElement("div");
      div.className="homework-box";
      div.innerHTML=`<strong>${d.learner}:</strong> ${d.answer}<br>
      <button onclick="markAnswer('${docu.id}',true)">Correct</button>
      <button onclick="markAnswer('${docu.id}',false)">Incorrect</button>`;
      if(d.marked===true) div.classList.add("marked-correct");
      if(d.marked===false) div.classList.add("marked-incorrect");
      container.appendChild(div);
    });
  }

  window.markAnswer=async(id,correct)=>{ await updateDoc(doc(db,"answers",id),{marked:correct}); loadSubmittedAnswers(); };
  document.addEventListener('contextmenu', e=>e.preventDefault());
</script>
</body>
</html>
